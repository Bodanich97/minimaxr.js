"use strict";function MxAnalysisCache(){this.Entries=[],this.Cursor=0,this.Get=function(player,depth,position){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=this.Entries[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var entry=_step.value;if(entry.Player===player&&!(entry.Depth<depth)&&entry.Position.Equals(position))return entry.Analysis}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return null},this.Set=function(player,depth,position,analysis){this.Cursor>=ANALYSIS_CACHE_SIZE&&(this.Cursor=0),this.Entries[this.Cursor]={Depth:depth,Position:position.Clone(),Analysis:analysis},this.Cursor++}}function MxPositionAnalysis(dynamicValue,staticValue,potentialValue,bestMove){this.DynamicValue=dynamicValue,this.StaticValue=staticValue,this.PotentialValue=potentialValue,this.BestMove=bestMove}function MxPosition(){this.Nodes=[];for(var sq=0;40>=sq;sq=NextSquare(sq))this.Nodes[sq]=1;for(var _sq=40;60>_sq;_sq=NextSquare(_sq))this.Nodes[_sq]=0;for(var _sq2=60;100>_sq2;_sq2=NextSquare(_sq2))this.Nodes[_sq2]=-1;this.LegalMovesX=function(player,square,direction,captureMode){try{for(var legalMoves=new Array,sq=0;100>sq;sq=NextSquare(sq)){var man=this.Nodes[sq];if(player*man>0&&(square===sq||null==square))for(var dir=0;4>dir;dir++)if((IsLegalDirection(player,dir)||IsKing(man)||captureMode)&&(direction===dir||null==direction))if(captureMode){var moveSegment=new Array,capture=this.GetCapture(sq,dir),perpendicularContinuationsFound=!1,lastLandingSquare=null;if(null==capture)continue;do{perpendicularContinuationsFound=!1,moveSegment=moveSegment.concat(capture),this.ExecuteMove(capture),lastLandingSquare=moveSegment[moveSegment.length-3];do{var legalContinuations=this.LegalMovesX(player,TerminalSquare(moveSegment),PreviousDirection(dir),!0);legalContinuations=legalContinuations.concat(this.LegalMovesX(player,TerminalSquare(moveSegment),NextDirection(dir),!0));var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=legalContinuations[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var continuation=_step2.value;legalMoves[legalMoves.length]=NormalizeMove(moveSegment.concat(continuation)),perpendicularContinuationsFound=!0}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}while(this.AdvanceTerminalSquare(moveSegment,dir));capture=this.GetCapture(TerminalSquare(moveSegment),dir)}while(null!=capture);if(!perpendicularContinuationsFound)for(legalMoves[legalMoves.length]=NormalizeMove(moveSegment);TerminalSquare(moveSegment)!==lastLandingSquare;){this.AdvanceTerminalSquare(moveSegment,OppositeDirection(dir));legalMoves[legalMoves.length]=NormalizeMove(moveSegment)}this.UndoMove(NormalizeMove(moveSegment))}else for(var nextSquare=NextSquare(sq,dir,1);this.IsFreeSquare(nextSquare)&&(legalMoves[legalMoves.length]=NormalizeMove(new Array(sq,man,0,nextSquare,0,man)),IsKing(man));)nextSquare=NextSquare(nextSquare,dir,1)}return legalMoves}catch(err){alert("LegalMovesX Error: "+err)}},this.LegalMoves=function(player){try{var legalMoves=this.LegalMovesX(player,null,null,!0);return 0===legalMoves.length&&(legalMoves=this.LegalMovesX(player,null,null,!1)),legalMoves}catch(err){alert("Legal Moves generation error: "+err)}},this.Clone=function(){for(var p=new MxPosition,s=0;100>s;s=NextSquare(s))p.Nodes[s]=this.Nodes[s];return p},this.Equals=function(pos){for(var s=0;100>s;s=NextSquare(s))if(pos.Nodes[s]!==this.Nodes[s])return!1;return!0},this.Analysis=function(player,depth,parentBestValue,parentDepth,untilQuiescent){try{var legalMoves=this.LegalMoves(player);if(0===legalMoves.length)return new MxPositionAnalysis(MIN_POSITION_VALUE,MIN_POSITION_VALUE,MIN_POSITION_VALUE,null);if(depth>=MIN_ANALYSIS_CACHE_DEPTH&&USE_ANALYSIS_CACHE){var cachedAnalysis=analysisCache.Get(player,depth,this);if(null!=cachedAnalysis)return cachedAnalysis}if(0===depth){if(!(untilQuiescent&&MAX_SEARCH_DEPTH>parentDepth&&CaptureCount(legalMoves[0])>0))return new MxPositionAnalysis(this.StaticValue(player),this.StaticValue(player),MIN_POSITION_VALUE,legalMoves[0]);depth=QUIESCENCE_EXTENSION_DEPTH}var bestValue=MAX_POSITION_VALUE,bestPotentialValue=MAX_POSITION_VALUE,bestChildMove=null,myPotentialValue=0,hit=!1,_iteratorNormalCompletion3=!0,_didIteratorError3=!1,_iteratorError3=void 0;try{for(var _step3,_iterator3=legalMoves[Symbol.iterator]();!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=!0){var mv=_step3.value;this.ExecuteMove(mv);var analysis=this.Analysis(-player,depth-1,bestValue,parentDepth+1,untilQuiescent);if(this.UndoMove(mv),myPotentialValue+=analysis.PotentialValue,(analysis.DynamicValue<bestValue||analysis.DynamicValue===bestValue&&analysis.PotentialValue<bestPotentialValue)&&(bestValue=analysis.DynamicValue,bestPotentialValue=analysis.PotentialValue,bestChildMove=mv,hit=!0),-bestValue>=parentBestValue&&USE_ALPHA_BETA_PRUNING)break}}catch(err){_didIteratorError3=!0,_iteratorError3=err}finally{try{!_iteratorNormalCompletion3&&_iterator3["return"]&&_iterator3["return"]()}finally{if(_didIteratorError3)throw _iteratorError3}}hit===!1&&console.log("not hit");var myAnalysis=new MxPositionAnalysis(-bestValue,this.StaticValue(player),-myPotentialValue,bestChildMove);return USE_ANALYSIS_CACHE&&analysisCache.Set(player,depth,this,myAnalysis),myAnalysis}catch(err){alert("Error performing analysis: "+err)}},this.ValueProfile=function(player){for(var valueProfile=new Array,d=0;MIN_SEARCH_DEPTH>d;d++)valueProfile[d]=this.DynamicValue(player,d,MAX_POSITION_VALUE,0,!1);return valueProfile[MIN_SEARCH_DEPTH]=this.DynamicValue(player,d,MAX_POSITION_VALUE,0,USE_QUIESCENCE_SEARCH),valueProfile},this.IsValidSquare=function(sq){try{var ssq=sq.toString();if(1===ssq.length&&(ssq="0"+ssq),2!==ssq.length)return!1;var row=parseInt(ssq.charAt(0)),col=parseInt(ssq.charAt(1));return row%2===0&&col%2===0||row%2===1&&col%2===1}catch(err){alert("IsValidSquare error: "+err)}},this.IsFreeSquare=function(sq){return this.IsValidSquare(sq)&&0===this.Nodes[sq]},this.ManCount=function(player){for(var c=0,sq=0;100>sq;sq=NextSquare(sq))(AreComrades(this.Nodes[sq],player)||null==player)&&c++;return c},this.StaticValue=function(player){return this.ManCount(player)-this.ManCount(-player)},this.GetCapture=function(square,direction){try{var mycapture=null,man=this.Nodes[square],nextSquare=NextSquare(square,direction,1);if(IsKing(man))for(;this.IsFreeSquare(nextSquare);)nextSquare=NextSquare(nextSquare,direction,1);var landingSq=NextSquare(nextSquare,direction,1);return this.Nodes[nextSquare]*man<0&&this.IsFreeSquare(landingSq)&&(mycapture=new Array(square,man,0,nextSquare,this.Nodes[nextSquare],0,landingSq,0,man)),mycapture}catch(err){alert("GetCapture error"+err)}},this.ExecuteMove=function(move){try{for(var x=0;x<move.length;x+=3)this.Nodes[move[x]]=move[x+2]}catch(err){alert("ExecuteMove Error: "+err)}},this.UndoMove=function(move){try{for(var x=0;x<move.length;x+=3)this.Nodes[move[x]]=move[x+1]}catch(err){alert("UndoMove Error: "+err)}},this.AdvanceTerminalSquare=function(move,dir){try{var finalMan=move[move.length-1];return this.Nodes[move[move.length-3]]!==finalMan&&alert("AdvanceTerminalSquare problem"),IsKing(finalMan)&&this.IsFreeSquare(NextSquare(TerminalSquare(move),dir,1))?(this.Nodes[NextSquare(TerminalSquare(move),dir,1)]=finalMan,this.Nodes[TerminalSquare(move)]=0,move[move.length-3]=NextSquare(TerminalSquare(move),dir,1),!0):!1}catch(err){alert("AdvanceTerminalSquare error"+err)}}}function MxGame(){this.MoveHistory=[],this.Position=new MxPosition,this.Turn=-1,this.BestMove=function(){return this.Position.Analysis(this.Turn,MIN_SEARCH_DEPTH,MAX_POSITION_VALUE,0,USE_QUIESCENCE_SEARCH).BestMove},this.TryAcceptMove=function(startSquare,endSquare){var _iteratorNormalCompletion4=!0,_didIteratorError4=!1,_iteratorError4=void 0;try{for(var _step4,_iterator4=this.Position.LegalMoves(this.Turn)[Symbol.iterator]();!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=!0){var mv=_step4.value;if(mv[0]===startSquare&&mv[mv.length-3]===endSquare)return this.Position.ExecuteMove(mv),this.MoveHistory.push(mv),!0}}catch(err){_didIteratorError4=!0,_iteratorError4=err}finally{try{!_iteratorNormalCompletion4&&_iterator4["return"]&&_iterator4["return"]()}finally{if(_didIteratorError4)throw _iteratorError4}}return!1}}function NormalizeMove(move){try{for(var rootMan=move[1],mv=new Array(move[0],move[1],move[2]),x=3;x<move.length-3;x+=3)AreComrades(rootMan,move[x+1])||AreComrades(rootMan,move[x+2])||(mv[mv.length]=move[x],mv[mv.length]=move[x+1],mv[mv.length]=move[x+2]);return mv[mv.length]=move[move.length-3],mv[mv.length]=move[move.length-2],mv[mv.length]=move[move.length-1],!IsKing(mv[mv.length-1])&&(1===rootMan&&mv[mv.length-3]>=91||-1===rootMan&&mv[mv.length-3]<=8)&&(mv[mv.length-1]=10*mv[mv.length-1]),mv}catch(err){alert("Move normalization error: "+err)}}function TerminalSquare(move){return move[move.length-3]}function NextSquare(sq,dir,steps){try{switch(null==sq&&(sq=0),null==steps&&(steps=1),dir){case NORTH_EAST:return sq+9*steps;case SOUTH_EAST:return sq-11*steps;case SOUTH_WEST:return sq-9*steps;case NORTH_WEST:return sq+11*steps;default:switch(sq.toString().charAt(sq.toString().length-1)){case"8":return sq+3;case"9":return sq+1;default:return sq+2}}}catch(err){alert("NextSquare error:"+err)}}function CaptureCount(move){return move.length/3-2}function IsKing(man){return man*man>1}function AreComrades(man1,man2){return man1*man2>0}function OppositeDirection(direction){return(direction+2)%4}function NextDirection(direction){return(direction+1)%4}function PreviousDirection(direction){return OppositeDirection(NextDirection(direction))}function IsLegalDirection(player,dir){return 1===player?dir===NORTH_EAST||dir===NORTH_WEST:dir===SOUTH_EAST||dir===SOUTH_WEST}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=exports.QUIESCENCE_EXTENSION_DEPTH=exports.MAX_POSITION_VALUE=exports.MIN_POSITION_VALUE=exports.MIN_ANALYSIS_CACHE_DEPTH=exports.ANALYSIS_CACHE_SIZE=exports.USE_ANALYSIS_CACHE=exports.USE_ALPHA_BETA_PRUNING=exports.USE_QUIESCENCE_SEARCH=exports.MAX_SEARCH_DEPTH=exports.MIN_SEARCH_DEPTH=void 0,require("babel-polyfill");var MIN_SEARCH_DEPTH=5,MAX_SEARCH_DEPTH=9,USE_QUIESCENCE_SEARCH=!0,USE_ALPHA_BETA_PRUNING=!0,USE_ANALYSIS_CACHE=!0,ANALYSIS_CACHE_SIZE=4e3,MIN_ANALYSIS_CACHE_DEPTH=3,MIN_POSITION_VALUE=-999,MAX_POSITION_VALUE=999,QUIESCENCE_EXTENSION_DEPTH=2,NORTH_EAST=0,SOUTH_EAST=1,SOUTH_WEST=2,NORTH_WEST=3,analysisCache=new MxAnalysisCache;exports.MIN_SEARCH_DEPTH=MIN_SEARCH_DEPTH,exports.MAX_SEARCH_DEPTH=MAX_SEARCH_DEPTH,exports.USE_QUIESCENCE_SEARCH=USE_QUIESCENCE_SEARCH,exports.USE_ALPHA_BETA_PRUNING=USE_ALPHA_BETA_PRUNING,exports.USE_ANALYSIS_CACHE=USE_ANALYSIS_CACHE,exports.ANALYSIS_CACHE_SIZE=ANALYSIS_CACHE_SIZE,exports.MIN_ANALYSIS_CACHE_DEPTH=MIN_ANALYSIS_CACHE_DEPTH,exports.MIN_POSITION_VALUE=MIN_POSITION_VALUE,exports.MAX_POSITION_VALUE=MAX_POSITION_VALUE,exports.QUIESCENCE_EXTENSION_DEPTH=QUIESCENCE_EXTENSION_DEPTH,exports["default"]=MxGame;