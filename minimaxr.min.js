"use strict";function mxAnalysisCache(){this.Nodes=new Array,this.Cursor=0,this.RetrieveAnalysis=function(player,depth,position){for(var n in this.Nodes){var entry=this.Nodes[n];if(entry.Player==player&&!(entry.Depth<depth)&&entry.Position.Equals(position))return entry.Analysis}return null},this.CacheAnalysis=function(player,depth,position,analysis){var myentry=new Object;myentry.Depth=depth,myentry.Position=position.Clone(),myentry.Analysis=analysis,this.Cursor>=analysis_cache_size&&(this.Cursor=0),this.Nodes[this.Cursor]=myentry,this.Cursor++}}function mxPositionAnalysis(dynamicValue,staticValue,potentialValue,bestMove){this.DynamicValue=dynamicValue,this.StaticValue=staticValue,this.PotentialValue=potentialValue,this.BestMove=bestMove}function mxPosition(){this.Nodes=new Array;for(var sq=0;40>=sq;sq=NextSquare(sq))this.Nodes[sq]=1;for(var sq=40;60>sq;sq=NextSquare(sq))this.Nodes[sq]=0;for(var sq=60;100>sq;sq=NextSquare(sq))this.Nodes[sq]=-1;this.LegalMovesX=function(player,square,direction,captureMode){try{for(var legalMoves=new Array,sq=0;100>sq;sq=NextSquare(sq)){var man=this.Nodes[sq];if(player*man>0&&(square==sq||null==square))for(var dir=0;4>dir;dir++)if((IsLegalDirection(player,dir)||IsKing(man)||captureMode)&&(direction==dir||null==direction))if(captureMode){var moveSegment=new Array,capture=this.GetCapture(sq,dir),perpendicularContinuationsFound=!1,lastLandingSquare=null;if(null==capture)continue;do{perpendicularContinuationsFound=!1,moveSegment=moveSegment.concat(capture),this.ExecuteMove(capture),lastLandingSquare=moveSegment[moveSegment.length-3];do{var legalContinuations=this.LegalMovesX(player,TerminalSquare(moveSegment),PreviousDirection(dir),!0);legalContinuations=legalContinuations.concat(this.LegalMovesX(player,TerminalSquare(moveSegment),NextDirection(dir),!0));for(var m in legalContinuations)legalMoves[legalMoves.length]=NormalizeMove(moveSegment.concat(legalContinuations[m])),perpendicularContinuationsFound=!0}while(this.AdvanceTerminalSquare(moveSegment,dir));capture=this.GetCapture(TerminalSquare(moveSegment),dir)}while(null!=capture);if(!perpendicularContinuationsFound)for(legalMoves[legalMoves.length]=NormalizeMove(moveSegment);TerminalSquare(moveSegment)!==lastLandingSquare;){this.AdvanceTerminalSquare(moveSegment,OppositeDirection(dir));legalMoves[legalMoves.length]=NormalizeMove(moveSegment)}this.UndoMove(NormalizeMove(moveSegment))}else for(var nextSquare=NextSquare(sq,dir,1);this.IsFreeSquare(nextSquare)&&(legalMoves[legalMoves.length]=NormalizeMove(new Array(sq,man,0,nextSquare,0,man)),IsKing(man));)nextSquare=NextSquare(nextSquare,dir,1)}return legalMoves}catch(err){alert("LegalMovesX Error: "+err)}},this.LegalMoves=function(player){try{var legalMoves=this.LegalMovesX(player,null,null,!0);return 0==legalMoves.length&&(legalMoves=this.LegalMovesX(player,null,null,!1)),legalMoves}catch(err){alert("Legal Moves generation error: "+err)}},this.Clone=function(){for(var p=new mxPosition,s=0;100>s;s=NextSquare(s))p.Nodes[s]=this.Nodes[s];return p},this.Equals=function(pos){for(var s=0;100>s;s=NextSquare(s))if(pos.Nodes[s]!=this.Nodes[s])return!1;return!0},this.Analysis=function(player,depth,parentBestValue,parentDepth,untilQuiescent){try{var legalMoves=this.LegalMoves(player);if(0==legalMoves.length)return new mxPositionAnalysis(minimum_position_value,minimum_position_value,minimum_position_value,null);if(depth>=min_analysis_cache_depth&&use_analysis_cache){var cachedAnalysis=analysis_cache.RetrieveAnalysis(player,depth,this);if(null!=cachedAnalysis)return cachedAnalysis}if(0==depth){if(!(untilQuiescent&&maximum_search_depth>parentDepth&&CaptureCount(legalMoves[0])>0))return new mxPositionAnalysis(this.StaticValue(player),this.StaticValue(player),minimum_position_value,legalMoves[0]);depth=quiescence_extension_depth}var bestValue=maximum_position_value,bestPotentialValue=maximum_position_value,bestChildMove=null,myPotentialValue=0,hit=!1;for(var m in legalMoves){this.ExecuteMove(legalMoves[m]);var analysis=this.Analysis(-player,depth-1,bestValue,parentDepth+1,untilQuiescent);if(this.UndoMove(legalMoves[m]),myPotentialValue+=analysis.PotentialValue,(analysis.DynamicValue<bestValue||analysis.DynamicValue==bestValue&&analysis.PotentialValue<bestPotentialValue)&&(bestValue=analysis.DynamicValue,bestPotentialValue=analysis.PotentialValue,bestChildMove=legalMoves[m],hit=!0),-bestValue>=parentBestValue&&use_alpha_beta_pruning)break}0==hit&&alert("not hit");var myAnalysis=new mxPositionAnalysis(-bestValue,this.StaticValue(player),-myPotentialValue,bestChildMove);return use_analysis_cache&&analysis_cache.CacheAnalysis(player,depth,this,myAnalysis),myAnalysis}catch(err){alert("Error performing analysis: "+err)}},this.ValueProfile=function valueProfile(player){for(var valueProfile=new Array,d=0;minimum_search_depth>d;d++)valueProfile[d]=this.DynamicValue(player,d,maximum_position_value,0,!1);return valueProfile[minimum_search_depth]=this.DynamicValue(player,d,maximum_position_value,0,use_quiescence_search),valueProfile},this.IsValidSquare=function(sq){try{var ssq=sq.toString();if(1==ssq.length&&(ssq="0"+ssq),2!=ssq.length)return!1;var row=parseInt(ssq.charAt(0)),col=parseInt(ssq.charAt(1));return row%2==0&&col%2==0||row%2==1&&col%2==1}catch(err){alert("IsValidSquare error: "+err)}},this.IsFreeSquare=function(sq){return this.IsValidSquare(sq)&&0==this.Nodes[sq]},this.ManCount=function(player){for(var c=0,sq=0;100>sq;sq=NextSquare(sq))(AreComrades(this.Nodes[sq],player)||null==player)&&c++;return c},this.StaticValue=function(player){return this.ManCount(player)-this.ManCount(-player)},this.GetCapture=function(square,direction){try{var mycapture=null,man=this.Nodes[square],nextSquare=NextSquare(square,direction,1);if(IsKing(man))for(;this.IsFreeSquare(nextSquare);)nextSquare=NextSquare(nextSquare,direction,1);var landingSq=NextSquare(nextSquare,direction,1);return this.Nodes[nextSquare]*man<0&&this.IsFreeSquare(landingSq)&&(mycapture=new Array(square,man,0,nextSquare,this.Nodes[nextSquare],0,landingSq,0,man)),mycapture}catch(err){alert("GetCapture error"+err)}},this.ExecuteMove=function(move){try{for(var x=0;x<move.length;x+=3)this.Nodes[move[x]]=move[x+2]}catch(err){alert("ExecuteMove Error: "+err)}},this.UndoMove=function(move){try{for(var x=0;x<move.length;x+=3)this.Nodes[move[x]]=move[x+1]}catch(err){alert("UndoMove Error: "+err)}},this.AdvanceTerminalSquare=function(move,dir){try{var finalMan=move[move.length-1];return IsKing(finalMan)&&this.IsFreeSquare(NextSquare(TerminalSquare(move),dir,1))?(this.Nodes[NextSquare(TerminalSquare(move),dir,1)]=finalMan,this.Nodes[TerminalSquare(move)]=0,move[move.length-3]=NextSquare(TerminalSquare(move),dir,1),!0):!1}catch(err){alert("AdvanceTerminalSquare error"+err)}}}function mxGame(){this.MoveHistory=new Array,this.Position=new mxPosition,this.Turn=-1,this.BestMove=function(){return this.Position.Analysis(this.Turn,minimum_search_depth,maximum_position_value,0,use_quiescence_search).BestMove},this.TryAcceptMove=function(startSquare,endSquare){var legalMoves=this.Position.LegalMoves(this.Turn);for(var m in legalMoves){var move=legalMoves[m];if(move[0]==startSquare&&move[move.length-3]==endSquare)return this.Position.ExecuteMove(move),this.MoveHistory[this.MoveHistory.length]=move,!0}return!1}}function NormalizeMove(move){try{for(var rootMan=move[1],mv=new Array(move[0],move[1],move[2]),x=3;x<move.length-3;x+=3)AreComrades(rootMan,move[x+1])||AreComrades(rootMan,move[x+2])||(mv[mv.length]=move[x],mv[mv.length]=move[x+1],mv[mv.length]=move[x+2]);return mv[mv.length]=move[move.length-3],mv[mv.length]=move[move.length-2],mv[mv.length]=move[move.length-1],!IsKing(mv[mv.length-1])&&(1==rootMan&&mv[mv.length-3]>=91||-1==rootMan&&mv[mv.length-3]<=8)&&(mv[mv.length-1]=10*mv[mv.length-1]),mv}catch(err){alert("Move normalization error: "+err)}}function TerminalSquare(move){return move[move.length-3]}function NextSquare(sq,dir,steps){try{switch(null==sq&&(sq=0),null==steps&&(steps=1),dir){case NORTH_EAST:return sq+9*steps;case SOUTH_EAST:return sq-11*steps;case SOUTH_WEST:return sq-9*steps;case NORTH_WEST:return sq+11*steps;default:switch(sq.toString().charAt(sq.toString().length-1)){case"8":return sq+3;case"9":return sq+1;default:return sq+2}}}catch(err){alert("NextSquare error:"+err)}}function CaptureCount(move){return move.length/3-2}function IsKing(man){return man*man>1}function AreComrades(man1,man2){return man1*man2>0}function OppositeDirection(direction){return(direction+2)%4}function NextDirection(direction){return(direction+1)%4}function PreviousDirection(direction){return OppositeDirection(NextDirection(direction))}function IsLegalDirection(player,dir){return 1===player?dir===NORTH_EAST||dir===NORTH_WEST:dir===SOUTH_EAST||dir===SOUTH_WEST}function Stealth(valueProfile){return valueProfile.avg()-valueProfile.last()}Object.defineProperty(exports,"__esModule",{value:!0}),require("babel-polyfill");var minimum_search_depth=5,maximum_search_depth=9,use_progressive_deepening=!0,use_quiescence_search=!0,use_alpha_beta_pruning=!0,use_analysis_cache=!0,use_singular_extensions=!1,analysis_cache_size=4e3,min_analysis_cache_depth=3,use_advanced_analysis_cache_aging=!1,use_opponent_modeling=!0,quiescence_extension_depth=2,minimum_position_value=-999,maximum_position_value=999,minimum_man_count=2,initial_man_count=20,NORTH_EAST=0,SOUTH_EAST=1,SOUTH_WEST=2,NORTH_WEST=3,analysis_cache=new mxAnalysisCache;exports["default"]=mxGame;